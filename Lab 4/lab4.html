<!--- Tovah Parnes - tovpar-9@student.ltu.se  -->

<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<title>Lab4 - The World is a Scene</title>

		<script id="vertex-shader" type="x-shader/x-vertex">
			attribute vec4 a_vertexPosition;
			attribute vec3 a_vertexNormal;
			uniform mat4 u_transformMatrix;
			uniform mat4 u_viewMatrix;
			uniform mat4 u_projectionMatrix;
			varying vec3 worldPosition;
			varying vec3 v_normal;
			varying float v_depth;
			varying vec4 v_eyeCoords;
			uniform vec4 ambientColor;

			void main()
			{
				worldPosition = (u_transformMatrix * a_vertexPosition).xyz;
				v_normal = normalize(mat3(u_transformMatrix)*a_vertexNormal.xyz);
				gl_Position = u_projectionMatrix * u_viewMatrix * u_transformMatrix * a_vertexPosition;
				v_eyeCoords = u_viewMatrix * u_transformMatrix * a_vertexPosition;
			}
		</script>

		<script id="fragment-shader" type="x-shader/x-fragment">
			precision mediump float;
			uniform vec4 u_color;
			varying float v_depth;
			varying vec3 v_normal;

			varying vec4 v_eyeCoords;
			uniform vec4 lightPosition;
			uniform vec4 ambientColor;
			uniform vec4 diffuseColor;
			uniform vec3 specularColor;
			uniform float specularExponent;
			void main()
			{
				//gl_FragColor = vec4(u_color[0]*1.5/v_depth, u_color[1]*1.5/v_depth, u_color[2]*1.5/v_depth, 1);
				vec3 N, L, R, V;  // Vectors for lighting equation.
			         N = normalize(v_normal);
			         if (lightPosition.w == 0.0) { // Directional light.
			             L = normalize(lightPosition.xyz);
			         } else { // Point light.
			             L = normalize(lightPosition.xyz / lightPosition.w - v_eyeCoords.xyz);
			         }
			         R = -reflect(L, N);
			         V = normalize(-v_eyeCoords.xyz);  // (Assumes a perspective projection.)

			         vec3 ambient = ambientColor.rgb * ambientColor.a;
			         vec3 diffuse = max(dot(L, N), 0.0) * diffuseColor.rgb * diffuseColor.a;
			         vec3 specular = vec3(0.0);
			         if (dot(L, N) > 0.0) {
			             specular = pow(max(dot(R, V), 0.0), specularExponent) * specularColor;
			         }
			         vec4 v_color = vec4(ambient + diffuse + specular, diffuseColor.a) * u_color;
			         gl_FragColor = v_color;
			}
		</script>
	</head>

	<body>
		<h2>Lab 3 - The Creation of a New World</h2>

		<noscript
			><p><b>Sorry, but this page requires JavaScript.</b></p></noscript
		>

		<center>
			<canvas id="gl-canvas" width="1700px" height="900px">
				Oops ... your browser doesn't support the HTML5 canvas element
			</canvas>
		</center>
		<br />
	</body>
	<script type="text/javascript" src="angel.js"></script>
	<script type="text/javascript" src="mesh.js"></script>
	<script type="text/javascript" src="shader.js"></script>
	<script type="text/javascript" src="shaderProgram.js"></script>
	<script type="text/javascript" src="material.js"></script>
	<script type="text/javascript" src="graphicsNode.js"></script>
	<script type="text/javascript" src="camera.js"></script>
	<script type="text/javascript" src="lab4.js"></script>
</html>
